# 牛顿下山法

## 1.牛顿法简单复习

### why

现实中很多问题不存在解析解，但是有数值解，因此需要一些方法获得问题的数值解或者近似解

### what

牛顿法就是其中一种方法，而且在函数的单根附近具有平方收敛的优点

![image-20230907105618688](https://buoutuanzi-picture.oss-cn-guangzhou.aliyuncs.com/tuchuang/image-20230907105618688.png)

### how

牛顿法是怎么起作用的？

对于非线性函数 $f(x)$，可以把方程在 $x0$ 处泰勒展开
$$
f(x) = f(x0) + f'(x0)(x - x0) + \frac{f''(x0)(x - x0)^2}{2!} + ... +\frac{f^{(n)}(x0)(x-x0)^n}{n!} + R_n(x)
$$
上述公式是严格相等的，而牛顿法的思想就是曲线方程线性化，即：泰勒展开前两项近似原方程
$$
f(x)\approx f(x0) + f'(x0)(x - x0)
$$

对于方程 $f(x)=0$ ，就近似为了 $f(x0) + f'(x0)(x - x0) = 0$

当 $f'(x_0)\neq0$ 可推出：
$$
x_1 = x_0 - \frac{f(x_0)}{f'(x_0)}
$$
这就是牛顿迭代法的递推公式，用图来举个例子

![image-20230906163858013](https://buoutuanzi-picture.oss-cn-guangzhou.aliyuncs.com/tuchuang/image-20230906163858013.png)


$$
f(x) = x^3
$$
可以看到 $x_n$ 在随着迭代次数增大，靠近 0 

## 2.牛顿下山法

### why

上面的牛顿法看起来非常美好，收敛速度快（平方收敛），公式简单，为什么还需要牛顿下山法？

#### 牛顿法的要求

牛顿法的收敛性与初值的选取有关，需要 $x_0$ 不能偏移要求的根太远

![image-20230906173107146](https://buoutuanzi-picture.oss-cn-guangzhou.aliyuncs.com/tuchuang/image-20230906173107146.png)

实例：

使用牛顿迭代法求 $x^3-x-1=0$ 在 1.5 附近的根，该函数图像如下：

![image-20230906173627920](https://buoutuanzi-picture.oss-cn-guangzhou.aliyuncs.com/tuchuang/image-20230906173627920.png)


$$
迭代公式：x_{n+1} = x_n - \frac{x_n^3 - x_n - 1}{3x_n^2 - 1}\\
取初值\ x_0 = 1.5\\
x_1 = 1.34783, f(x_1) = 0.100699585826687\\
x_2 = 1.32520, f(x_2) = 0.0020566590079995617\\
x_3 = 1.32472, f(x_3) = 8.711618047607672e-06
$$
效果还不错，但是让我们把初值选的远一点
$$
取初值\ x_0 = 0.6\\
x_1 = 17.899999999999984
$$
反而离我们需要的根更远了

咋办？上面都说了收敛与初值相关，那能不能在初值选择上做文章？

##### 限制初值选取

由于牛顿迭代法是一种不动点迭代格式，因此可以使用不动点迭代的局部收敛原则，即：

==设 $\phi(x)$ 在 $x = \phi(x)$ 的根 $x^*$ 的领域内有连续的一阶导数，而且满足：|$\phi'(x)$| < 1,那么对任意的$x_0 \in$ 该领域，迭代格式对应的迭代过程均收敛于根 $x^*$==

```
不动点迭代法又称迭代法或简单迭代法，是一种逐次逼近的方法，它是用某个固定公式反复矫正根的近似值，使之逐步精确，最后得到满足精度要求的结果。
```

对于牛顿迭代法：
$$
\phi(x) = x - \frac{f(x)}{f'(x)}\\
\phi'(x) = 1 - \frac{f(x)f''(x)}{[f'(x)]^2}\\
对根 \alpha,\ 若f'(\alpha) \neq 0 ,\ 则\phi'(\alpha) = 0
$$
由 $\phi’(x)$ 连续性可知，存在一个邻域（$\alpha - \theta,\ \alpha + \theta$）,对于区域内的一切 x 有：|$\phi'(x)$| < 1，所以是可以通过限制初值，达到百分百收敛的，条件总结如下：（网上抄的）

对于区间 [a, b]，x $\in$ [a, b] 满足

(1) $f(a)f(b) < 0$  -- 根存在

(2)$f'(x) \neq 0$         --函数单调

(3)$f''(x)$不变号    --函数凹向不变

(4)$x_0 \in [a,b]$

不满足也不一定不行，但是满足了一定行

看了就麻烦还不一定能达成，有其他办法没（看看标题是啥）

##### 牛顿下山法

简单来说牛顿下山法可以通过给迭代法公式添加添加一个要求，防止迭代发散

```
注意：下山法只能防止迭代发散，不能防止迭错根
```



### how

#### 原理

回顾一下我们的问题：我们需要找的是 $f(x) = 0$ 的根。

而牛顿迭代发散之后会有什么表现？

就是下一次迭代出来的 $f(x_{n+1})$ 比 $f(x_n)$ 并没有离 0 更近了，数学表达 $|f(x_{n+1})| > |f(x_n)|$

那么我们只需要加一个限制，要求下一次迭代的 x 离 0 更近  $|f(x_{n+1})| < |f(x_n)|$ 就能避免迭代发散

如何找到满足不等式的 $x_{n+1}$ 呢？

观察一下函数图像，以一个发生了死循环的牛顿迭代为例

![image-20230907113135878](https://buoutuanzi-picture.oss-cn-guangzhou.aliyuncs.com/tuchuang/image-20230907113135878.png)

可以看到沿着迭代方向走，是可以离 0 更近的，但是问题是一步跨太远了，所以通过缩小步子就能找到我们要的$x_{n+1}$

因此牛顿下山法对牛顿迭代法进行一下调整：
$$
牛顿迭代公式：x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}\\
牛顿下山法公式：x_{n+1} = x_n - \lambda\frac{f(x_n)}{f'(x_n)}
$$
其中的 $\lambda$ 称为下山因子，一般取 $\lambda = 1, \frac{1}{2},\frac{1}{2^2} ,...$

#### 流程

1. 选择初值 $x_0$ 
2. 下山因子 $\lambda = 1$
3. 计算 $x_{n+1}$
4. 计算 $f(x_{n+1})$ 
5. 比较$|f(x_{n+1})|$ 和 $|f(x_{n})|$ 
   1. 若 $|f(x_{n+1})|$ < $|f(x_{n})|$
      1. 若 $x_{n+1} - x_n$ 满足误差要求，迭代结束
      2.  若 $x_{n+1} - x_n$ 未满足误差要求，进行下一轮迭代
   2. $|f(x_{n+1})| >= |f(x_{n})|$，下山因子缩小一般，重复步骤345
   

```
牛顿下山法也不能保证一定收敛，但是有些牛顿迭代法不收敛的初值，使用牛顿下山法后会收敛，因此也要设置迭代次数上限
```

## 参考

[平方收敛证明](https://cs.nyu.edu/~overton/NumericalComputing/newton.pdf)

[山东大学数值分析慕课](https://www.icourse163.org/course/NEU-1002089009?from=searchPage&outVendor=zw_mooc_pcssjg_) （不推荐，老师在念ppt）

[《数值分析》| 华科 | 研究生基础课](https://www.bilibili.com/video/BV1AK4y1k7Px/?spm_id_from=333.337.search-card.all.click&vd_source=774248cd919b7f5028cfefb783991907)

